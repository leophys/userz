# How to modify/extend this microservice

## Store

### SQL

Prerequisites to be installed to develop on the store:
  - [go-migrate][gm]
  - [sqlc][sqlc]

#### Migrations

To add a migration run, in `./store/pg/`, the following:

```
migrate create -ext sql -dir migrations -seq <migration-name>
```

This will create two files `NNNNNN_<migration-name>.{up,down}.sql`. You have to
edit the files and add the SQL statements you want the automation to run at
startup, and the corresponding statements to revert the migration.

#### Queries and statements

The golang implementation of queries and statements are generated by
[sqlc][sqlc]. To add or modify them, you have to modify `./store/pg/queries.sql`
and then run, from the same directory, `go generate`. The resulting
implementation will be in `./store/pg/postgres`.

[gm]: https://github.com/golang-migrate/migrate
[sqlc]: https://github.com/kyleconroy/sqlc

## gRPC service

### Prerequisites

You need `protoc-gen-go` and `protoc-gen-go-grpc` installed. On archlinux you
can get them on the AUR

```
pikaur -Sy protoc-gen-go protoc-gen-go-grpc
```

### Modify the service

The definition of the service, together with the types, lays at
[./proto/userz.proto](./proto/userz.proto). Modify the definitions therein and
then run, from `proto/`

```
go generate
```

## Notification plugins

To develop a new plugin to handle notifications, one must implement the
interface at `github.com/leophys/userz/pkg/notifier`. The `.so` may be obtained
compiling the main entrypoint with the `-buildmode=plugin` flag.
